<% content_for :main_aside do %>

  <%= render partial: 'learn/dashboard/show', locals: {klass: @klass} if staff?(current_user, @klass) %>
  
  <% if @klass.open? && @klass.allow_enrollment %>
    <% deadlines = @klass.upcoming_deadlines %>
    <% unless deadlines.to_a.empty? %>
      <% content_for :additional_nav do %>
        <%= ui_panel(capture do %>
          <%= ui_icon(:calendar) %>
          <%= t('page.title.upcoming_deadlines') %>
        <% end, nil, capture do %>
          <ul>
            <% deadlines.each do |deadline| %>
              <li>
                <%= t("page.text.upcoming_deadlines", :name => deadline.name,
                      :count => (deadline.closes_at.to_date - Time.zone.today).to_i)
                %>
              </li>
          	<% end %>
          </ul>
          <% end, nil, :primary) %>
      <% end %>
    <% end %>
  <% end %>

  <%= yield :additional_nav %>

  <!-- Klass Updates -->
  <% if false && @klass.open? && staff?(current_user, @klass) %>
    <%= form_for [:teach, @klass.course, @klass, Update.new], remote: true do |f| %>
      <%= f.markdown :body, :size => '60x3', :label => false, :placeholder => 'New update goes here' %>
      <%= f.submit %>
    <% end %>
    <hr />
  <% end %>

  <% updates = Update.sent(@klass, :www => true) %>
  <div id="klass-updates">
    <%= render partial: 'learn/klasses/update', collection: updates %>
  </div>
<% end %>

<%= content = capture do %>
  <% if @klass.course&.syllabus&.published %>
    <%= ui_header @klass.course.syllabus.name %>
    <%= markdown(@klass.course.syllabus.about) %>
  <% else %>
    <%= markdown(@klass.course.about) %>
  <% end %>
  
  <%= render 'learn/lectures/outline' %>
<% end %>
